<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XII RPL 2 - SUPREME COMMAND</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f4f7fe; color: #1e293b; transition: 0.3s; }
        .hide { display: none !important; }
        .sidebar-active { @apply bg-indigo-600 text-white shadow-xl shadow-indigo-300 scale-105; }
        .bento { @apply bg-white rounded-[2.5rem] p-8 border border-slate-200/60 shadow-sm hover:shadow-2xl transition-all duration-500; }
        .chat-area { height: 450px; overflow-y: auto; display: flex; flex-direction: column; scroll-behavior: smooth; }
        .avatar-lg { @apply w-16 h-16 rounded-[1.5rem] border-4 border-white shadow-lg object-cover bg-slate-200; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="antialiased">

    <div id="view-login" class="min-h-screen flex items-center justify-center bg-slate-950 relative overflow-hidden p-6">
        <div class="absolute w-[600px] h-[600px] bg-indigo-600 rounded-full blur-[180px] -top-20 -left-20 opacity-20"></div>
        <div class="z-10 w-full max-w-lg animate__animated animate__fadeIn">
            <div class="text-center mb-10 text-white">
                <h1 class="text-7xl font-black italic tracking-tighter">RPL<span class="text-indigo-500">2.</span></h1>
                <p class="text-xs font-bold uppercase tracking-[0.5em] opacity-50 mt-4">Supreme Class Management</p>
            </div>
            <div class="bg-white p-12 rounded-[4rem] shadow-2xl">
                <div class="space-y-5">
                    <div>
                        <label class="text-[10px] font-black uppercase text-slate-400 ml-2 mb-2 block">Akses Sebagai</label>
                        <select id="login-role" onchange="syncLoginNames()" class="w-full p-5 bg-slate-50 rounded-2xl font-bold border-2 border-transparent focus:border-indigo-500 transition-all outline-none appearance-none">
                            <option value="" disabled selected>Pilih Role...</option>
                            <option value="Walas">Wali Kelas</option>
                            <option value="Guru">Guru Mata Pelajaran</option>
                            <option value="Ketua Kelas">Ketua Kelas</option>
                            <option value="Sekretaris">Sekretaris</option>
                            <option value="Bendahara">Bendahara</option>
                            <option value="Murid">Siswa/i RPL 2</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-[10px] font-black uppercase text-slate-400 ml-2 mb-2 block">Nama Lengkap</label>
                        <select id="login-name" class="w-full p-5 bg-slate-50 rounded-2xl font-bold border-2 border-transparent focus:border-indigo-500 transition-all outline-none appearance-none">
                            <option value="" disabled selected>Pilih Nama...</option>
                        </select>
                    </div>
                    <button onclick="doLogin()" class="w-full bg-indigo-600 text-white py-6 rounded-3xl font-black uppercase tracking-widest hover:bg-slate-900 transition-all shadow-xl shadow-indigo-200">Masuk Sistem</button>
                </div>
            </div>
        </div>
    </div>

    <div id="view-app" class="hide flex min-h-screen">
        <aside class="w-80 bg-white border-r border-slate-100 p-8 fixed h-full flex flex-col z-50">
            <div class="mb-10 flex items-center gap-4">
                <div class="w-12 h-12 bg-slate-950 rounded-2xl flex items-center justify-center text-white text-2xl font-black italic">R2</div>
                <div>
                    <h2 class="text-xl font-black italic leading-none">RPL 2</h2>
                    <p class="text-[8px] font-black text-indigo-500 uppercase tracking-widest mt-1">Premiere Hub</p>
                </div>
            </div>
            
            <nav class="space-y-1 flex-1 overflow-y-auto pr-2 custom-scroll">
                <button onclick="nav('dash')" id="btn-dash" class="sidebar-btn w-full text-left p-4 rounded-2xl font-bold text-slate-400 flex items-center gap-4 transition-all"><i class="fas fa-home-alt"></i> Dashboard</button>
                <button onclick="nav('chat')" id="btn-chat" class="sidebar-btn w-full text-left p-4 rounded-2xl font-bold text-slate-400 flex items-center gap-4 transition-all"><i class="fas fa-comment-alt-lines"></i> Forum Chat</button>
                <button onclick="nav('absen')" id="btn-absen" class="sidebar-btn w-full text-left p-4 rounded-2xl font-bold text-slate-400 flex items-center gap-4 transition-all"><i class="fas fa-user-check"></i> Absensi</button>
                <button onclick="nav('kas')" id="btn-kas" class="sidebar-btn w-full text-left p-4 rounded-2xl font-bold text-slate-400 flex items-center gap-4 transition-all"><i class="fas fa-wallet"></i> Uang Kas</button>
                <button onclick="nav('piket')" id="btn-piket" class="sidebar-btn w-full text-left p-4 rounded-2xl font-bold text-slate-400 flex items-center gap-4 transition-all"><i class="fas fa-broom"></i> Jadwal Piket</button>
                <button onclick="nav('voting')" id="btn-voting" class="sidebar-btn w-full text-left p-4 rounded-2xl font-bold text-slate-400 flex items-center gap-4 transition-all"><i class="fas fa-poll-h"></i> Polling Kelas</button>
                <button onclick="nav('materi')" id="btn-materi" class="sidebar-btn w-full text-left p-4 rounded-2xl font-bold text-slate-400 flex items-center gap-4 transition-all"><i class="fas fa-book-open"></i> Mapel & Materi</button>
                <button onclick="nav('extra')" id="btn-extra" class="sidebar-btn w-full text-left p-4 rounded-2xl font-bold text-slate-400 flex items-center gap-4 transition-all"><i class="fas fa-stars"></i> Extra 20+</button>
                
                <div id="admin-gate" class="hide pt-6">
                    <p class="text-[9px] font-black text-slate-300 uppercase tracking-widest px-4 mb-2">Control Room</p>
                    <button onclick="nav('admin')" id="btn-admin" class="sidebar-btn w-full text-left p-4 rounded-2xl font-bold text-indigo-600 bg-indigo-50 flex items-center gap-4"><i class="fas fa-user-shield"></i> Walas Editor</button>
                </div>
            </nav>

            <button onclick="logout()" class="p-5 mt-6 bg-red-50 text-red-500 rounded-2xl font-black text-[10px] uppercase tracking-[0.3em] hover:bg-red-500 hover:text-white transition-all"><i class="fas fa-power-off mr-2"></i> Keluar</button>
        </aside>

        <main class="ml-80 flex-1 p-12">
            <header class="flex justify-between items-end mb-12">
                <div>
                    <h3 id="page-title" class="text-5xl font-black italic tracking-tighter uppercase">Dashboard</h3>
                    <p id="clock" class="text-[11px] font-bold text-indigo-500 uppercase tracking-[0.4em] mt-2"></p>
                </div>
                <div class="flex items-center gap-6 bg-white p-3 pr-8 rounded-[2rem] shadow-sm border">
                    <div class="relative group">
                        <img id="my-ava" src="" class="avatar-lg">
                        <label class="absolute inset-0 bg-black/60 rounded-[1.5rem] opacity-0 group-hover:opacity-100 flex items-center justify-center cursor-pointer transition-all">
                            <i class="fas fa-camera text-white"></i>
                            <input type="file" id="up-ava" class="hidden" accept=".png">
                        </label>
                    </div>
                    <div>
                        <p id="u-name" class="text-lg font-black leading-none text-slate-900">Name</p>
                        <p id="u-role" class="text-[9px] font-bold text-indigo-500 uppercase tracking-[0.2em] mt-2">Role</p>
                    </div>
                </div>
            </header>

            <div id="content-flow">
                <section id="section-dash" class="page-content grid grid-cols-1 md:grid-cols-3 gap-8 animate__animated animate__fadeIn">
                    <div onclick="nav('materi')" class="col-span-2 bg-indigo-600 rounded-[3.5rem] p-12 text-white relative overflow-hidden cursor-pointer group">
                        <i class="fas fa-calendar-alt absolute -right-10 -bottom-10 text-[20rem] opacity-10 group-hover:scale-110 transition-all"></i>
                        <p class="text-xs font-black uppercase tracking-[0.4em] opacity-70 mb-4">Mata Pelajaran Saat Ini:</p>
                        <h2 id="live-mapel" class="text-6xl font-black italic tracking-tighter mb-6">Mencari...</h2>
                        <div class="flex items-center gap-6">
                            <span id="live-jam" class="bg-white/20 px-6 py-3 rounded-2xl font-black text-sm">--:--</span>
                            <span class="text-sm font-bold opacity-60 italic underline">Lihat Jadwal Mingguan âžœ</span>
                        </div>
                    </div>
                    <div class="bento flex flex-col items-center justify-center">
                        <p class="text-[10px] font-black text-slate-400 uppercase tracking-[0.3em] mb-6">Mood Kelas</p>
                        <div class="text-7xl animate-bounce">ðŸ”¥</div>
                        <p class="mt-6 font-black text-slate-800">RPL 2 ON FIRE!</p>
                    </div>
                    <div class="bento col-span-1">
                        <p class="text-[10px] font-black text-slate-400 uppercase mb-4">Kas Terkumpul</p>
                        <h3 id="dash-kas" class="text-4xl font-black italic text-indigo-600">Rp 0</h3>
                    </div>
                    <div class="bento col-span-2 overflow-hidden">
                        <p class="text-[10px] font-black text-indigo-500 uppercase mb-4 tracking-widest">Berita Kelas</p>
                        <marquee class="font-bold text-slate-700 text-lg">Informasi: Pengumpulan Tugas Portofolio RPL diundur sampai hari Sabtu! â€¢ Jangan lupa bayar uang kas ke Khaysila! â€¢ Jaga kebersihan kelas!</marquee>
                    </div>
                </section>

                <section id="section-chat" class="page-content hide animate__animated animate__fadeInUp">
                    <div class="bg-white rounded-[3.5rem] shadow-2xl border flex flex-col h-[75vh] overflow-hidden">
                        <div id="chat-box" class="chat-area p-10 space-y-6 custom-scroll"></div>
                        <div class="p-8 bg-slate-50 border-t flex gap-4">
                            <input type="text" id="chat-in" placeholder="Tulis pesan..." class="flex-1 p-6 bg-white rounded-3xl font-bold outline-none shadow-sm focus:ring-4 ring-indigo-500/10 border-none">
                            <button onclick="pushChat()" class="w-24 bg-indigo-600 text-white rounded-3xl flex items-center justify-center hover:scale-105 active:scale-95 transition-all">
                                <i class="fas fa-paper-plane text-2xl"></i>
                            </button>
                        </div>
                    </div>
                </section>

                <section id="section-voting" class="page-content hide space-y-8">
                    <div id="poll-ctrl" class="hide bento bg-indigo-50 border-indigo-100">
                        <h4 class="font-black text-xl mb-6 italic">Buat Polling Baru (Ketua Kelas Only)</h4>
                        <div class="flex gap-4">
                            <input type="text" id="poll-q" placeholder="Contoh: Lokasi Jalan-jalan Kelas?" class="flex-1 p-5 rounded-2xl border-none shadow-inner font-bold">
                            <button onclick="addPoll()" class="bg-indigo-600 text-white px-10 rounded-2xl font-black uppercase text-xs">Publish</button>
                        </div>
                    </div>
                    <div id="poll-list" class="grid grid-cols-1 md:grid-cols-2 gap-8"></div>
                </section>

                <section id="section-admin" class="page-content hide bento">
                    <h3 class="text-3xl font-black italic mb-10 border-b pb-6">Walas Control Center</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                        <div>
                            <p class="text-xs font-black uppercase text-indigo-500 mb-6 tracking-widest">Atur Jadwal Pelajaran</p>
                            <div id="edit-mapel" class="space-y-3"></div>
                        </div>
                        <div>
                            <p class="text-xs font-black uppercase text-indigo-500 mb-6 tracking-widest">Atur Petugas Piket</p>
                            <div id="edit-piket" class="space-y-3"></div>
                        </div>
                    </div>
                </section>

                <section id="section-absen" class="page-content hide grid grid-cols-1 md:grid-cols-3 gap-4" id="absensi-grid"></section>
                <section id="section-kas" class="page-content hide bento" id="kas-history"></section>
                <section id="section-piket" class="page-content hide grid grid-cols-1 md:grid-cols-5 gap-4" id="piket-full"></section>
                <section id="section-materi" class="page-content hide bento" id="materi-full"></section>
                <section id="section-extra" class="page-content hide grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div class="bento h-40 flex flex-col items-center justify-center">
                        <i class="fas fa-qrcode text-3xl mb-3 text-indigo-600"></i>
                        <p class="font-black text-[10px] uppercase">QR Absen</p>
                    </div>
                    <div class="bento h-40 flex flex-col items-center justify-center">
                        <i class="fas fa-pencil-ruler text-3xl mb-3 text-amber-500"></i>
                        <p class="font-black text-[10px] uppercase">Digital Stationery</p>
                    </div>
                    <div class="bento h-40 flex flex-col items-center justify-center">
                        <i class="fas fa-images text-3xl mb-3 text-emerald-500"></i>
                        <p class="font-black text-[10px] uppercase">Class Gallery</p>
                    </div>
                    <div class="bento h-40 flex flex-col items-center justify-center">
                        <i class="fas fa-music text-3xl mb-3 text-red-500"></i>
                        <p class="font-black text-[10px] uppercase">Class Playlist</p>
                    </div>
                </section>

            </div>
        </main>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, push, onValue, query, limitToLast, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCKoeMMj0-iAVb_xp998S1W3U4KU3fuFVs",
            authDomain: "web-kelaz.firebaseapp.com",
            databaseURL: "https://web-kelaz-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "web-kelaz",
            storageBucket: "web-kelaz.firebasestorage.app",
            messagingSenderId: "393212253974",
            appId: "1:393212253974:web:722ee1237a62d949536237"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- MASTER DATA (GURU & MURID) ---
        const MURID = ["A Fabian Syah", "Abdul Wafi", "Achmad Wildan", "Ahmad Alfi", "Ahmad Azriel", "Andrea Hafshah Oktavia", "Attaya Kayla", "Cahyo Kartiko", "Farrel Alkhayri", "Karina Sakila", "Kevin Oktavian Suryana", "Khaysila", "Kinddy Putra", "M Naufal Permana", "M Reza Febriansyah", "M Rizki Fadilah Guntor", "M Rizki Mulya", "M Rizqi Mubarak", "M Sigit Maulana", "M Tegar Alyasin", "M. Refi Yanto", "Moch Farel Al Khairy", "Muhamad Daffa Alexandrio", "Muhamad Raffi Alfathir", "Muhammad Ridwan", "Raehan Syafa", "Raffa Maydiansyah", "Rafi Izatul", "Rahil Aristya Aimar", "Rama Putra", "Ranie Dwi Putri", "Revan", "Syakirah Azraa", "Three Argha Zulita", "Vino Pratama", "Vino Sigit H", "Zainal Arifin"].sort();
        
        const GURU_MAPEL = [
            "Bpk/Ibu B. Indonesia", "Bpk/Ibu B. Inggris", "Bpk/Ibu B. Jepang", 
            "Bpk/Ibu Matematika", "Bpk/Ibu Sejarah", "Bpk/Ibu PKN", 
            "Bpk/Ibu PKK", "Bpk/Ibu Produktif", "Bpk/Ibu PAI", "Bpk/Ibu PJOK"
        ];

        // --- AUTH LOGIC ---
        window.syncLoginNames = () => {
            const role = document.getElementById('login-role').value;
            const sel = document.getElementById('login-name');
            sel.innerHTML = '<option disabled selected>Pilih Nama...</option>';
            let list = [];
            if(role === 'Walas') list = ["Wali Kelas XII RPL 2"];
            else if(role === 'Guru') list = GURU_MAPEL;
            else list = MURID;
            list.forEach(n => sel.innerHTML += `<option value="${n}">${n}</option>`);
        };

        window.doLogin = () => {
            const r = document.getElementById('login-role').value;
            const n = document.getElementById('login-name').value;
            if(!r || !n) return;
            localStorage.setItem('user_v5', JSON.stringify({ n, r }));
            initApp();
        };

        window.logout = () => { localStorage.clear(); location.reload(); };

        // --- NAVIGATION ---
        window.nav = (p) => {
            document.querySelectorAll('.page-content').forEach(e => e.classList.add('hide'));
            document.querySelectorAll('.sidebar-btn').forEach(e => e.classList.remove('sidebar-active'));
            document.getElementById('section-'+p).classList.remove('hide');
            document.getElementById('btn-'+p).classList.add('sidebar-active');
            document.getElementById('page-title').innerText = p.toUpperCase();
        };

        // --- INITIALIZE ---
        function initApp() {
            const user = JSON.parse(localStorage.getItem('user_v5'));
            if(!user) return;
            document.getElementById('view-login').classList.add('hide');
            document.getElementById('view-app').classList.remove('hide');
            document.getElementById('u-name').innerText = user.n;
            document.getElementById('u-role').innerText = user.r;
            
            const ava = localStorage.getItem('ava_'+user.n);
            document.getElementById('my-ava').src = ava || `https://ui-avatars.com/api/?name=${user.n}`;

            if(user.r === 'Walas') document.getElementById('admin-gate').classList.remove('hide');
            if(user.r === 'Ketua Kelas') document.getElementById('poll-ctrl').classList.remove('hide');

            startClocks();
            syncData();
            nav('dash');
        }

        function startClocks() {
            setInterval(() => {
                const now = new Date();
                document.getElementById('clock').innerText = now.toLocaleString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', hour: '2-digit', minute: '2-digit', second: '2-digit' });
                updateSmartMapel(now);
            }, 1000);
        }

        // --- SMART MAPEL LOGIC ---
        function updateSmartMapel(now) {
            const hour = now.getHours();
            const min = now.getMinutes();
            const val = hour * 100 + min;
            let m = "Jam Bebas", t = "--:--";

            if(val >= 700 && val < 1000) { m = "Produktif RPL (Coding)"; t = "07:00 - 10:00"; }
            else if(val >= 1000 && val < 1200) { m = "Bahasa Inggris"; t = "10:00 - 12:00"; }

            document.getElementById('live-mapel').innerText = m;
            document.getElementById('live-jam').innerText = t;
        }

        // --- CHAT MODERASI (Newest at Bottom) ---
        window.pushChat = () => {
            const u = JSON.parse(localStorage.getItem('user_v5'));
            const t = document.getElementById('chat-in').value;
            if(!t) return;
            push(ref(db, 'chats_v5'), {
                n: u.n, r: u.r, t: t,
                ava: localStorage.getItem('ava_'+u.n) || '',
                time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                ts: Date.now()
            });
            document.getElementById('chat-in').value = '';
        };

        window.delChat = (id) => {
            if(confirm('Hapus chat ini?')) remove(ref(db, 'chats_v5/' + id));
        };

        // --- POLLING LOGIC ---
        window.addPoll = () => {
            const q = document.getElementById('poll-q').value;
            if(!q) return;
            push(ref(db, 'polls_v5'), { q, creator: 'Ketua Kelas' });
            document.getElementById('poll-q').value = '';
        };

        window.vote = (id, choice) => {
            const u = JSON.parse(localStorage.getItem('user_v5'));
            if(u.r === 'Walas' || u.r === 'Guru') return alert('Hanya Murid/Perangkat yang boleh voting!');
            set(ref(db, `polls_v5/${id}/votes/${u.n.replace(/\s/g, '_')}`), choice);
        };

        // --- SYNC ENGINE ---
        function syncData() {
            const user = JSON.parse(localStorage.getItem('user_v5'));

            onValue(query(ref(db, 'chats_v5'), limitToLast(50)), (snap) => {
                const box = document.getElementById('chat-box');
                box.innerHTML = '';
                snap.forEach(c => {
                    const m = c.val();
                    const isMe = m.n === user.n;
                    const mod = (user.r === 'Walas' || user.r === 'Ketua Kelas');
                    const ava = m.ava || `https://ui-avatars.com/api/?name=${m.n}`;

                    box.innerHTML += `
                        <div class="flex gap-4 ${isMe ? 'flex-row-reverse' : ''} animate__animated animate__fadeInUp">
                            <img src="${ava}" class="w-12 h-12 rounded-2xl shadow-md border-2 border-white">
                            <div class="max-w-[70%] relative group">
                                <p class="text-[9px] font-black uppercase text-slate-400 mb-1 ${isMe ? 'text-right' : ''}">${m.n} â€¢ ${m.time}</p>
                                <div class="p-5 rounded-[2rem] ${isMe ? 'bg-indigo-600 text-white rounded-tr-none' : 'bg-white border rounded-tl-none'} shadow-sm">
                                    <p class="text-sm font-bold">${m.t}</p>
                                </div>
                                ${mod ? `<button onclick="delChat('${c.key}')" class="absolute -top-2 -right-2 w-7 h-7 bg-red-500 text-white rounded-full text-[10px] opacity-0 group-hover:opacity-100 transition-all shadow-lg">âœ•</button>` : ''}
                            </div>
                        </div>`;
                });
                box.scrollTop = box.scrollHeight;
            });

            onValue(ref(db, 'polls_v5'), (snap) => {
                const box = document.getElementById('poll-list');
                box.innerHTML = '';
                snap.forEach(c => {
                    const p = c.val();
                    const votes = p.votes ? Object.values(p.votes) : [];
                    const yes = votes.filter(v => v === 'Y').length;
                    const no = votes.filter(v => v === 'N').length;
                    box.innerHTML += `
                        <div class="bento bg-slate-50">
                            <h4 class="font-black text-xl mb-6">${p.q}</h4>
                            <div class="flex gap-3 mb-6">
                                <button onclick="vote('${c.key}','Y')" class="flex-1 py-4 bg-emerald-500 text-white rounded-2xl font-black text-xs">SETUJU (${yes})</button>
                                <button onclick="vote('${c.key}','N')" class="flex-1 py-4 bg-red-500 text-white rounded-2xl font-black text-xs">TIDAK (${no})</button>
                            </div>
                            <div class="h-2 bg-slate-200 rounded-full overflow-hidden flex">
                                <div class="bg-emerald-500 h-full" style="width: ${yes/(yes+no||1)*100}%"></div>
                                <div class="bg-red-500 h-full" style="width: ${no/(yes+no||1)*100}%"></div>
                            </div>
                        </div>`;
                });
            });

            // Absensi Sync (Sesuai List 37 Murid)
            onValue(ref(db, 'absen_v5'), (snap) => {
                const data = snap.val() || {};
                const grid = document.getElementById('section-absen');
                grid.innerHTML = MURID.map(m => {
                    const k = m.replace(/\s/g, '_');
                    const s = data[k] || 'B';
                    const canE = ['Walas','Sekretaris','Ketua Kelas'].includes(user.r);
                    return `
                        <div class="bento !p-4 flex justify-between items-center">
                            <span class="text-[10px] font-black">${m}</span>
                            <div class="flex gap-1">
                                ${['H','S','I','A'].map(o => `<button onclick="${canE ? `set(ref(db,'absen_v5/${k}'),'${o}')` : ''}" class="w-8 h-8 rounded-lg text-[9px] font-black ${s===o?'bg-indigo-600 text-white shadow-lg':'bg-slate-100 text-slate-300'}">${o}</button>`).join('')}
                            </div>
                        </div>`;
                }).join('');
            });
        }

        // Avatar Upload
        document.getElementById('up-ava').addEventListener('change', (e) => {
            const reader = new FileReader();
            reader.onload = (ev) => {
                const user = JSON.parse(localStorage.getItem('user_v5'));
                localStorage.setItem('ava_'+user.n, ev.target.result);
                document.getElementById('my-ava').src = ev.target.result;
            };
            reader.readAsDataURL(e.target.files[0]);
        });

        initApp();
    </script>
</body>
</html>
